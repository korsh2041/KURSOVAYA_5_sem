<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Library — Регистрация</title>
    <style>
        :root{
          --border: 4px solid #000;
          --w: 420px;
        }
        *{ box-sizing:border-box; }
        body{
          margin:0;
          background:#fff;
          color:#000;
          font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        }
        .page{
          min-height:100vh;
          display:flex;
          align-items:flex-start;
          justify-content:center;
          padding:64px 20px;
        }
        .wrap{
          width: min(var(--w), 100%);
          text-align:center;
        }
        h1{
          margin: 0 0 40px 0;
          font-size: 56px;
          font-weight: 800;
          letter-spacing: .3px;
        }

        .field, .select{
          width:100%;
          border: var(--border);
          padding: 12px 14px;
          margin: 0 auto 16px auto;
          font-size: 18px;
          font-weight: 800;
          outline:none;
          background:#fff;
          color:#000;
        }
        .field::placeholder{
          color:#000;
          opacity:1;
          font-weight:800;
        }

        /* "Выберите роль" как поле */
        .select{
          appearance:none;
          -webkit-appearance:none;
          -moz-appearance:none;
          background-image:
            linear-gradient(45deg, transparent 50%, #000 50%),
            linear-gradient(135deg, #000 50%, transparent 50%);
          background-position:
            calc(100% - 22px) calc(50% - 3px),
            calc(100% - 14px) calc(50% - 3px);
          background-size: 8px 8px, 8px 8px;
          background-repeat:no-repeat;
          padding-right: 44px;
          cursor:pointer;
        }

        /* Доп.поля — скрыты до выбора роли */
        .role-extra{ display:none; }

        /* Кнопка регистрации (в стиле полей) */
        .btn{
          width:100%;
          border: 4px solid #000;
          padding: 14px 14px;
          margin-top: 24px;
          font-size: 20px;
          font-weight: 800;
          background:#fff;
          color:#000;
          cursor:pointer;
        }
        .btn:hover{
          background:#000;
          color:#fff;
        }

        /* маленький “воздух” как на скринах */
        .spacer-bottom{ height: 8px; }
    </style>
</head>
<body>
<main class="page">
    <section class="wrap" aria-label="Регистрация">
        <h1>Library</h1>

        <!-- 1) Выберите роль -->
        <select id="role" class="select" aria-label="Выберите роль">
            <option value="" selected>Выберите роль</option>
            <option value="teacher">Преподаватель</option>
            <option value="student">Студент</option>
            <option value="librarian">Библиотекарь</option>
        </select>

        <!-- 2) Базовые поля (как на 2 фото) -->
        <input id="userId" class="field" type="text" placeholder="Введите id пользователя" />
        <label for="name" style="display:block;text-align:left;font-weight:900;margin:8px 0 4px 0;">ФИО</label>
        <input id="name" class="field" type="text" placeholder="Введите ФИО (имя пользователя)" autofocus />
        <input id="email" class="field" type="email" placeholder="Введите email" />
        <input id="phone" class="field" type="tel" placeholder="Введите телефон (8...)" />
        <div class="spacer-bottom"></div>
        <input id="password" class="field" type="password" placeholder="Введите пароль" />
        <input id="confirmPassword" class="field" type="password" placeholder="Подтвердите пароль" />

        <!-- 3) Доп. поля по роли -->
        <div id="extraTeacher" class="role-extra" data-role="teacher">
            <input id="extraTeacher1" class="field" type="text" placeholder="Введите id сотрудника" />
            <input id="extraTeacher2" class="field" type="text" placeholder="Введите кафедру" />
        </div>

        <div id="extraStudent" class="role-extra" data-role="student">
            <input id="extraStudent1" class="field" type="text" placeholder="Введите студенческий билет" />
            <input id="extraStudent2" class="field" type="text" placeholder="Введите факультет" />
        </div>

        <div id="extraLibrarian" class="role-extra" data-role="librarian">
            <input id="extraLibrarian1" class="field" type="text" placeholder="Введите id библиотекаря" />
            <input id="extraLibrarian2" class="field" type="text" placeholder="Введите № смены" />
        </div>

        <!-- Кнопка появляется ТОЛЬКО после выбора роли -->
        <button id="registerBtn" class="btn" type="button" style="display:none;">
            Зарегистрироваться
        </button>
    </section>
</main>

<script>
    const roleSelect = document.getElementById('role');
    const registerBtn = document.getElementById('registerBtn');

    const blocks = {
      teacher: document.getElementById('extraTeacher'),
      student: document.getElementById('extraStudent'),
      librarian: document.getElementById('extraLibrarian'),
    };

    function hideAllExtras(){
      Object.values(blocks).forEach(el => el.style.display = 'none');
      registerBtn.style.display = 'none'; // до выбора роли кнопки нет
    }

    roleSelect.addEventListener('change', () => {
      hideAllExtras();
      const role = roleSelect.value;

      if (blocks[role]) {
        blocks[role].style.display = 'block';
        registerBtn.style.display = 'block'; // после выбора роли — есть
      }
    });

    // старт: строго как на 2 фото
    hideAllExtras();

    // (опционально) заглушка на клик
    registerBtn.addEventListener('click', async () => {
      const userId = document.getElementById('userId').value.trim();
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const userType = roleSelect.value;
      
      // Валидация на фронтенде
      if (!userId) {
        alert('Пожалуйста, введите ID пользователя');
        return;
      }
      if (!name) {
        alert('Пожалуйста, введите ФИО');
        return;
      }
      if (!email) {
        alert('Пожалуйста, введите email');
        return;
      }
      if (!phone) {
        alert('Пожалуйста, введите телефон');
        return;
      }
      if (!password) {
        alert('Пожалуйста, введите пароль');
        return;
      }
      if (password !== confirmPassword) {
        alert('Пароли не совпадают');
        return;
      }
      
      // Сбор дополнительной информации по роли
      let additionalInfo = '';
      if (userType === 'teacher') {
        const id = document.getElementById('extraTeacher1').value.trim();
        const dept = document.getElementById('extraTeacher2').value.trim();
        additionalInfo = id && dept ? `ID сотрудника: ${id}, Кафедра: ${dept}` : '';
      } else if (userType === 'student') {
        const ticket = document.getElementById('extraStudent1').value.trim();
        const faculty = document.getElementById('extraStudent2').value.trim();
        additionalInfo = ticket && faculty ? `Билет: ${ticket}, Факультет: ${faculty}` : '';
      } else if (userType === 'librarian') {
        const id = document.getElementById('extraLibrarian1').value.trim();
        const shift = document.getElementById('extraLibrarian2').value.trim();
        additionalInfo = id && shift ? `ID библиотекаря: ${id}, Смена: ${shift}` : '';
      }
      
      try {
        const response = await fetch('http://localhost:8080/api/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            userId: userId,
            name: name,
            email: email,
            phone: phone,
            password: password,
            confirmPassword: confirmPassword,
            userType: userType,
            additionalInfo: additionalInfo
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('Регистрация успешна! Добро пожаловать, ' + name);
          // Сохранение сессии
          localStorage.setItem('sessionId', data.sessionId);
          localStorage.setItem('user', JSON.stringify(data.user));
          // Перенаправление на страницу в зависимости от роли
          if (userType === 'teacher') {
            window.location.href = 'teacher.html';
          } else if (userType === 'librarian') {
            window.location.href = 'librarian.html';
          } else {
            window.location.href = 'student.html';
          }
        } else {
          alert('Ошибка регистрации: ' + data.message);
        }
      } catch (error) {
        alert('Ошибка подключения: ' + error.message);
      }
    });
</script>
</body>
</html>
